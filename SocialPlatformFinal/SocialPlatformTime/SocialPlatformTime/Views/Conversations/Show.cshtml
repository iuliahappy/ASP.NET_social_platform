@model IEnumerable<SocialPlatformTime.Models.Message>

@{
    ViewData["Title"] = "Conversație";
    var currentUserId = ViewBag.CurrentUserId as string;
}

<div class="container mt-4">
    <div class="card shadow-sm">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <h4 class="mb-0">Chat</h4>
            <a asp-controller="Conversations" asp-action="Index" class="btn btn-sm btn-outline-light">Înapoi</a>
        </div>

        <div id="chatWindow" class="card-body" style="height: 500px; overflow-y: auto; background-color: #f0f2f5;">
            @foreach (var message in Model)
            {
                bool isMine = message.ApplicationUserId == currentUserId;

                <div class="d-flex @(isMine ? "justify-content-end" : "justify-content-start") mb-3">
                    <div class="p-3 shadow-sm @(isMine ? "bg-primary text-white rounded-chat-mine" : "bg-white text-dark rounded-chat-other")"
                         style="max-width: 75%; position: relative; min-width: 100px;">

                        @if (!isMine)
                        {
                            <small class="d-block font-weight-bold mb-1" style="font-size: 0.75rem; color: #007bff;">
                                @message.ApplicationUser?.UserName
                            </small>
                        }

                        <p class="mb-1">@message.Content</p>

                        <div class="d-flex justify-content-end align-items-center">
                            <small style="font-size: 0.65rem; opacity: 0.8;">
                                @message.dateTime.ToString("HH:mm")
                            </small>

                            @if (isMine)
                            {
                                <span class="ms-1" style="font-size: 0.8rem; line-height: 1;">
                                    @if (message.IsRead)
                                    {
                                        <span class="text-info" title="Văzut de toți" style="color: #4fc3f7 !important;">✔</span>
                                    }
                                </span>
                            }
                        </div>
                    </div>
                </div>
            }
        </div>

        <div class="card-footer bg-white">
            <form asp-controller="Messages" asp-action="New" method="post" class="input-group">
                <input type="hidden" name="ConversationId" value="@ViewBag.ConversationId" />
                <input type="text" name="Content" class="form-control border-0 bg-light" placeholder="Scrie un mesaj..." required autocomplete="off">
                <button type="submit" class="btn btn-primary px-4">Trimite</button>
            </form>
        </div>
    </div>
</div>

<style>
    .rounded-chat-mine {
        border-radius: 18px 18px 0px 18px !important;